(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[751],{4751:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ClientsModule:()=>H});var n=i(3679),r=i(3142),a=i(8583),s=i(7716),o=i(4655);let c=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-clients-home"]],decls:2,vars:0,consts:[[1,"container"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s._UZ(1,"router-outlet"),s.qZA())},directives:[o.lC],encapsulation:2}),t})(),l=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-client"]],decls:2,vars:0,template:function(t,e){1&t&&(s.TgZ(0,"p"),s._uU(1,"client works!"),s.qZA())},encapsulation:2}),t})();var u=i(1494),d=i(2789),m=i(2238),g=i(9765),p=i(4395),f=i(8002),h=i(5766),Z=i(41),v=i(380),q=i(8295),A=i(9983),x=i(1095),b=i(9992);function T(t,e){1&t&&(s.TgZ(0,"mat-error",20),s._uU(1,"El usuario es obligatorio"),s.qZA())}function w(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"mat-list-option",23),s.NdJ("click",function(){const e=s.CHM(t).$implicit;return s.oxw(2).selectSuggestedUser(e.username)})("keyup.enter",function(){const e=s.CHM(t).$implicit;return s.oxw(2).selectSuggestedUser(e.username)}),s._uU(1),s.qZA()}if(2&t){const t=e.$implicit;s.Q6J("value",t.username),s.xp6(1),s.Oqu(t.username)}}function C(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"mat-selection-list",21),s.NdJ("click",function(){return s.CHM(t),s.oxw().showSuggestion}),s.YNc(1,w,2,2,"mat-list-option",22),s.qZA()}if(2&t){const t=s.oxw();s.Q6J("multiple",!1),s.xp6(1),s.Q6J("ngForOf",t.suggestedUsers)}}function U(t,e){1&t&&(s.TgZ(0,"mat-error",20),s._uU(1,"La raz\xf3n social es obligatoria"),s.qZA())}function _(t,e){1&t&&(s.TgZ(0,"mat-error",20),s._uU(1,"El CIF es obligatorio"),s.qZA())}function y(t,e){1&t&&(s.TgZ(0,"mat-error",20),s._uU(1,"La localidad es obligatoria"),s.qZA())}function N(t,e){1&t&&(s.TgZ(0,"mat-error",20),s._uU(1,"La provincia es obligatoria"),s.qZA())}function k(t,e){1&t&&(s.TgZ(0,"mat-error",20),s._uU(1,"El direcci\xf3n es obligatoria"),s.qZA())}let F=(()=>{class t{constructor(t,e,i,r,a){this.data=t,this.matDialogRef=e,this.fb=i,this.userService=r,this.clientService=a,this.client=null,this.title="",this.showSuggestion=!0,this.suggestedUsers=[],this.users=[],this.debouncer$=new g.xQ,this.clientForm=this.fb.group({username:["",[n.kI.required]],name:["",[n.kI.required]],cif:["",[n.kI.required]],address:["",[n.kI.required]],city:["",[n.kI.required]],province:["",[n.kI.required]]})}ngOnInit(){this.userService.findAll().subscribe(t=>{var e,i;this.users=t.users;const n=(null===(e=this.users.find(t=>{var e;return t.id===(null===(e=this.data)||void 0===e?void 0:e.user.id)}))||void 0===e?void 0:e.username)||"";null===(i=this.clientForm.get("username"))||void 0===i||i.setValue(n)}),this.client=this.data,this.data?this.initUpdate():this.initCreate(),this.debouncer$.pipe((0,p.b)(300)).subscribe(t=>{t?(this.suggestedUsers=this.users.filter(e=>e.username.trim().toLowerCase().includes(t.trim().toLowerCase())),this.showSuggestion=1!==this.suggestedUsers.length||this.suggestedUsers[0].username!==t):this.showSuggestion=!1})}search(){var t;const e=null===(t=this.clientForm.get("username"))||void 0===t?void 0:t.value;this.debouncer$.next(e)}save(){this.data?this.update():this.create()}selectSuggestedUser(t){var e;null===(e=this.clientForm.get("username"))||void 0===e||e.setValue(t)}isValidField(t){return this.clientForm.controls[t].errors&&this.clientForm.controls[t].touched}initUpdate(){this.title="Actualizar cliente",this.clientForm.reset(Object.assign({},this.data))}initCreate(){this.title="Crear cliente"}update(){this.data&&this.clientService.update(this.data.id,Object.assign({},this.clientForm.value)).subscribe(()=>{var t,e;this.matDialogRef.close(Object.assign(Object.assign({},this.clientForm.value),{id:null===(t=this.data)||void 0===t?void 0:t.id,user:null===(e=this.data)||void 0===e?void 0:e.user}))})}create(){var t;const e=this.users.find(t=>{var e;return t.username===(null===(e=this.clientForm.get("username"))||void 0===e?void 0:e.value)});if(!e)throw new Error(`No existe ning\xfan usuario con el nombre ${null===(t=this.clientForm.get("username"))||void 0===t?void 0:t.value}`);const i=Object.assign(Object.assign({},this.clientForm.value),{userId:e.id});this.clientService.create(i).pipe((0,f.U)(t=>this.userService.findOne(t.client.userId)),(0,h.u)()).subscribe(t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(m.WI),s.Y36(m.so),s.Y36(n.qu),s.Y36(Z.K),s.Y36(v.y))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-client-create-dialog"]],decls:54,vars:14,consts:[[1,"d-flex","flex-wrap","gap-2","justify-content-center",3,"formGroup","ngSubmit"],[1,"flex-grow-1"],[1,"w-100","d-flex","flex-wrap","gap-2"],["appearance","fill",1,"w-100"],["matInput","","type","text","autocomplete","off","formControlName","username",3,"input","ngModelChange"],["class","form-text text-danger",4,"ngIf"],["class","position-absolute bg-light suggestion",3,"multiple","click",4,"ngIf"],["matInput","","type","text","formControlName","name"],[1,"d-flex","flex-wrap","gap-2"],["matInput","","type","text","formControlName","cif"],["matInput","","type","text","formControlName","city"],[1,"d-flex","flex-wrap"],["matInput","","type","text","formControlName","province"],["appearance","fill",1,"row","w-100"],["matInput","","type","text","formControlName","address"],[1,"flex-grow-1","overflow-scroll"],[1,"bg-dark","text-white","p-3","rounded"],[1,"d-flex","justify-content-end","w-100"],["mat-button","","color","warn","mat-dialog-close",""],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"form-text","text-danger"],[1,"position-absolute","bg-light","suggestion",3,"multiple","click"],[3,"value","click","keyup.enter",4,"ngFor","ngForOf"],[3,"value","click","keyup.enter"]],template:function(t,e){1&t&&(s.TgZ(0,"h1"),s._uU(1),s.qZA(),s._UZ(2,"hr"),s.TgZ(3,"form",0),s.NdJ("ngSubmit",function(){return e.save()}),s.TgZ(4,"div",1),s.TgZ(5,"div",2),s.TgZ(6,"div",1),s.TgZ(7,"mat-form-field",3),s.TgZ(8,"mat-label"),s._uU(9,"Usuario"),s.qZA(),s.TgZ(10,"input",4),s.NdJ("input",function(){return e.search()})("ngModelChange",function(){return e.search()}),s.qZA(),s.YNc(11,T,2,0,"mat-error",5),s.qZA(),s.YNc(12,C,2,2,"mat-selection-list",6),s.qZA(),s.TgZ(13,"div",1),s.TgZ(14,"mat-form-field",3),s.TgZ(15,"mat-label"),s._uU(16,"Raz\xf3n social"),s.qZA(),s._UZ(17,"input",7),s.YNc(18,U,2,0,"mat-error",5),s.qZA(),s.qZA(),s.qZA(),s.TgZ(19,"div",8),s.TgZ(20,"div",1),s.TgZ(21,"mat-form-field",3),s.TgZ(22,"mat-label"),s._uU(23,"CIF"),s.qZA(),s._UZ(24,"input",9),s.YNc(25,_,2,0,"mat-error",5),s.qZA(),s.qZA(),s.TgZ(26,"div",1),s.TgZ(27,"mat-form-field",3),s.TgZ(28,"mat-label"),s._uU(29,"Localidad"),s.qZA(),s._UZ(30,"input",10),s.YNc(31,y,2,0,"mat-error",5),s.qZA(),s.qZA(),s.qZA(),s.TgZ(32,"div",11),s.TgZ(33,"div",1),s.TgZ(34,"mat-form-field",3),s.TgZ(35,"mat-label"),s._uU(36,"Provincia"),s.qZA(),s._UZ(37,"input",12),s.YNc(38,N,2,0,"mat-error",5),s.qZA(),s.qZA(),s.qZA(),s.TgZ(39,"mat-form-field",13),s.TgZ(40,"mat-label"),s._uU(41,"Direcci\xf3n"),s.qZA(),s._UZ(42,"input",14),s.YNc(43,k,2,0,"mat-error",5),s.qZA(),s.qZA(),s.TgZ(44,"div",15),s._uU(45),s.TgZ(46,"pre",16),s._uU(47),s.ALo(48,"json"),s.qZA(),s.qZA(),s.TgZ(49,"div",17),s.TgZ(50,"button",18),s._uU(51,"Cerrar"),s.qZA(),s.TgZ(52,"button",19),s._uU(53," Guardar "),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(1),s.Oqu(e.title),s.xp6(2),s.Q6J("formGroup",e.clientForm),s.xp6(8),s.Q6J("ngIf",e.isValidField("username")),s.xp6(1),s.Q6J("ngIf",e.showSuggestion),s.xp6(6),s.Q6J("ngIf",e.isValidField("name")),s.xp6(7),s.Q6J("ngIf",e.isValidField("cif")),s.xp6(6),s.Q6J("ngIf",e.isValidField("city")),s.xp6(7),s.Q6J("ngIf",e.isValidField("province")),s.xp6(5),s.Q6J("ngIf",e.isValidField("address")),s.xp6(2),s.hij(" Formulario: ",e.clientForm.valid," "),s.xp6(2),s.hij("      ",s.lcZ(48,12,e.clientForm.value),"\n    "),s.xp6(5),s.Q6J("disabled",e.clientForm.invalid))},directives:[n._Y,n.JL,n.sg,q.KE,q.hX,A.Nt,n.Fj,n.JJ,n.u,a.O5,x.lW,m.ZT,q.TO,b.Ub,a.sg,b.vS],pipes:[a.Ts],styles:["mat-list-item[_ngcontent-%COMP%]{cursor:pointer}mat-list-item[_ngcontent-%COMP%]:hover{background-color:#0000001a!important}.suggestion[_ngcontent-%COMP%]{z-index:9999!important}"]}),t})();var S=i(6518),I=i(2522);function Y(t,e){1&t&&(s.TgZ(0,"th",21),s._uU(1,"CIF"),s.qZA())}function J(t,e){if(1&t&&(s.TgZ(0,"td",22),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.xp6(1),s.hij(" ",t.cif," ")}}function O(t,e){1&t&&(s.TgZ(0,"th",21),s._uU(1,"Raz\xf3n social"),s.qZA())}function D(t,e){if(1&t&&(s.TgZ(0,"td",23),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.xp6(1),s.Oqu(t.name)}}function Q(t,e){1&t&&(s.TgZ(0,"th",21),s._uU(1,"Direcci\xf3n"),s.qZA())}function M(t,e){if(1&t&&(s.TgZ(0,"td",23),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.xp6(1),s.Oqu(t.address)}}function j(t,e){1&t&&(s.TgZ(0,"th",21),s._uU(1,"Localidad"),s.qZA())}function E(t,e){if(1&t&&(s.TgZ(0,"td",23),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.xp6(1),s.Oqu(t.city)}}function $(t,e){1&t&&(s.TgZ(0,"th",21),s._uU(1,"Provincia"),s.qZA())}function L(t,e){if(1&t&&(s.TgZ(0,"td",23),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.xp6(1),s.Oqu(t.province)}}function R(t,e){1&t&&s._UZ(0,"tr",24)}function z(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"tr",25),s.NdJ("click",function(){const e=s.CHM(t).$implicit;return s.oxw().openDialogCreateClient(e)}),s.qZA()}}function B(t,e){if(1&t&&(s.TgZ(0,"tr",26),s.TgZ(1,"td",27),s._uU(2),s.qZA(),s.qZA()),2&t){s.oxw();const t=s.MAs(11);s.xp6(2),s.hij(' No data matching the filter "',t.value,'" ')}}const V=[{path:"",component:c,children:[{path:"list",component:(()=>{class t{constructor(t,e,i){this.authService=t,this.clientService=e,this.matDialog=i,this.displayedColumns=["cif","name","address","city","province"],this.dataSource=new d.by([]),this.clients=[],this.term=""}ngAfterViewInit(){this.clientService.findAll().subscribe(t=>{this.dataSource.data=t.clients,this.clients=t.clients}),this.dataSource.sort=this.sort}applyFilter(t){let e=t.target.value;e.trim().toLowerCase(),this.dataSource.data=this.clients.filter(t=>`${t.name}${t.city}`.trim().toLowerCase().includes(e))}openDialogCreateClient(t){t?this.matDialog.open(F,{data:t}).afterClosed().subscribe(t=>{if(t){const e=this.clients.findIndex(e=>e.id===t.id);this.clients[e]=t,this.dataSource.data=this.clients}}):this.matDialog.open(F).afterClosed().subscribe(t=>{t&&(this.clients.push(t),this.dataSource.data=this.clients)})}toExcel(){this.clientService.toExcel(this.term?this.term:"-").subscribe(t=>{console.log(t);const e=document.createElement("a");e.href=t,e.click()})}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(S.e),s.Y36(v.y),s.Y36(m.uw))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-clients-list"]],viewQuery:function(t,e){if(1&t&&s.Gf(u.YE,5),2&t){let t;s.iGM(t=s.CRH())&&(e.sort=t.first)}},decls:34,vars:4,consts:[[1,"d-flex","justify-content-between"],["mat-raised-button","","color","primary",3,"click"],[1,"d-flex","w-100"],["appearance","standard",1,"flex-grow-1"],["matInput","","placeholder","Ex. Mia",3,"ngModel","ngModelChange","keyup"],["input",""],[1,"d-flex","justify-content-center","align-items-center","p-3"],["src","assets/img/excel.png",1,"img-thumbnail",3,"click"],[1,"mat-elevation-z8"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","cif"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","pe-3","class","pe-4",4,"matCellDef"],["matColumnDef","name"],["mat-cell","","class","pe-3",4,"matCellDef"],["matColumnDef","address"],["matColumnDef","city"],["matColumnDef","province"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"pe-4"],["mat-cell","",1,"pe-3"],["mat-header-row",""],["mat-row","",3,"click"],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(t,e){1&t&&(s.TgZ(0,"mat-toolbar",0),s.TgZ(1,"span"),s._uU(2,"Clientes"),s.qZA(),s.TgZ(3,"div"),s.TgZ(4,"button",1),s.NdJ("click",function(){return e.openDialogCreateClient()}),s._uU(5," A\xf1adir cliente "),s.qZA(),s.qZA(),s.qZA(),s.TgZ(6,"div",2),s.TgZ(7,"mat-form-field",3),s.TgZ(8,"mat-label"),s._uU(9,"Filter"),s.qZA(),s.TgZ(10,"input",4,5),s.NdJ("ngModelChange",function(t){return e.term=t})("keyup",function(t){return e.applyFilter(t)}),s.qZA(),s.qZA(),s.TgZ(12,"div",6),s.TgZ(13,"img",7),s.NdJ("click",function(){return e.toExcel()}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(14,"div",8),s.TgZ(15,"table",9),s.ynx(16,10),s.YNc(17,Y,2,0,"th",11),s.YNc(18,J,2,1,"td",12),s.BQk(),s.ynx(19,13),s.YNc(20,O,2,0,"th",11),s.YNc(21,D,2,1,"td",14),s.BQk(),s.ynx(22,15),s.YNc(23,Q,2,0,"th",11),s.YNc(24,M,2,1,"td",14),s.BQk(),s.ynx(25,16),s.YNc(26,j,2,0,"th",11),s.YNc(27,E,2,1,"td",14),s.BQk(),s.ynx(28,17),s.YNc(29,$,2,0,"th",11),s.YNc(30,L,2,1,"td",14),s.BQk(),s.YNc(31,R,1,0,"tr",18),s.YNc(32,z,1,0,"tr",19),s.YNc(33,B,3,1,"tr",20),s.qZA(),s.qZA()),2&t&&(s.xp6(10),s.Q6J("ngModel",e.term),s.xp6(5),s.Q6J("dataSource",e.dataSource),s.xp6(16),s.Q6J("matHeaderRowDef",e.displayedColumns),s.xp6(1),s.Q6J("matRowDefColumns",e.displayedColumns))},directives:[I.Ye,x.lW,q.KE,q.hX,A.Nt,n.Fj,n.JJ,n.On,d.BZ,u.YE,d.w1,d.fO,d.Dz,d.as,d.nj,d.Ee,d.ge,u.nU,d.ev,d.XQ,d.Gk],styles:["tr[_ngcontent-%COMP%]:hover{background-color:#0000001a}img[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:hover{cursor:pointer}img[_ngcontent-%COMP%]{height:30px;width:30px}"]}),t})()},{path:"client",component:l},{path:"**",redirectTo:"list"}]}];let P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[o.Bz.forChild(V)],o.Bz]}),t})(),H=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[a.ez,P,n.UX,n.u5,r.q]]}),t})()}}]);